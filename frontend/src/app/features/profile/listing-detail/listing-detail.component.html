<div class="listing-detail-container" *ngIf="!loading() && listing()">
  <!-- Header Actions -->
  <div class="header-actions">
    <button class="back-btn" (click)="backToListings()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Listings
    </button>
    
    <div class="action-buttons">
      <button class="btn-secondary" (click)="editListing()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
        Edit
      </button>
      <button class="btn-secondary" (click)="duplicateListing()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
        Duplicate
      </button>
      <button class="btn-primary" (click)="toggleStatus()" *ngIf="canToggleStatus()">
        {{ getActionButtonText() }}
      </button>
      <button class="btn-danger" (click)="confirmDelete()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
        Delete
      </button>
    </div>
  </div>

  <!-- Image Gallery -->
  <div class="image-gallery">
    <div class="main-image">
      <img [src]="listing()!.images[selectedImageIndex()]?.imageUrl || '/images/placeholder.jpg'" 
           [alt]="listing()!.title">
      <div class="image-nav">
        <button class="nav-btn prev" (click)="previousImage()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <button class="nav-btn next" (click)="nextImage()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
      <div class="image-counter">
        {{ selectedImageIndex() + 1 }} / {{ listing()!.images.length }}
      </div>
    </div>
    
    <div class="image-thumbnails">
      <div *ngFor="let image of listing()!.images; let i = index" 
           class="thumbnail" 
           [class.active]="i === selectedImageIndex()"
           (click)="selectImage(i)">
        <img [src]="image.imageUrl" [alt]="'Photo ' + (i + 1)">
      </div>
    </div>
  </div>

  <!-- Listing Info Header -->
  <div class="listing-header">
    <div class="title-section">
      <h1>{{ listing()!.title }}</h1>
      <div class="subtitle">
        <span class="badge type-badge">{{ propertyTypeLabels[listing()!.propertyType] }}</span>
        <span class="badge room-badge">{{ roomTypeLabels[listing()!.roomType] }}</span>
        <span class="badge" [ngClass]="getStatusClass(listing()!.status)">
          {{ listingStatusLabels[listing()!.status] }}
        </span>
      </div>
      <p class="location">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        {{ listing()!.address }}, {{ listing()!.city }}, {{ listing()!.country }}
      </p>
    </div>
    
    <div class="price-section">
      <div class="price">{{ formatPrice(listing()!.basePrice) }}</div>
      <div class="price-label">per night</div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="tabs">
    <button class="tab" [class.active]="activeTab() === 'overview'" (click)="switchTab('overview')">
      Overview
    </button>
    <button class="tab" [class.active]="activeTab() === 'bookings'" (click)="switchTab('bookings')">
      Bookings
      <span class="count-badge" *ngIf="bookings().length > 0">{{ bookings().length }}</span>
    </button>
    <button class="tab" [class.active]="activeTab() === 'analytics'" (click)="switchTab('analytics')">
      Analytics
    </button>
    <button class="tab" [class.active]="activeTab() === 'reviews'" (click)="switchTab('reviews')">
      Reviews
      <span class="count-badge" *ngIf="listing()!.stats?.reviewCount">{{ listing()!.stats?.reviewCount }}</span>
    </button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Overview Tab -->
    <div *ngIf="activeTab() === 'overview'" class="overview-content">
      <div class="content-grid">
        <!-- Left Column -->
        <div class="main-content">
          <!-- Property Details -->
          <section class="info-section">
            <h2>Property Details</h2>
            <div class="details-grid">
              <div class="detail-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2"/>
                  <path d="M9 3v18"/>
                </svg>
                <span>{{ listing()!.bedrooms }} Bedrooms</span>
              </div>
              <div class="detail-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-1 0l-1 1a1.5 1.5 0 0 0 0 1L7 9"/>
                  <path d="M15 5 9 11l4 4 6-6-4-4zM22 4l-4 4"/>
                </svg>
                <span>{{ listing()!.bathrooms }} Bathrooms</span>
              </div>
              <div class="detail-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>{{ listing()!.maxGuests }} Guests</span>
              </div>
              <div class="detail-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <span>{{ listing()!.propertySize }} sq ft</span>
              </div>
            </div>
          </section>

          <!-- Description -->
          <section class="info-section">
            <h2>Description</h2>
            <p class="description">{{ listing()!.description }}</p>
          </section>

          <!-- Amenities -->
          <section class="info-section" *ngIf="listing()!.amenities?.length">
            <h2>Amenities</h2>
            <div class="amenities-grid">
              <div *ngFor="let amenity of listing()!.amenities" class="amenity-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
                {{ amenity }}
              </div>
            </div>
          </section>

          <!-- House Rules -->
          <section class="info-section" *ngIf="listing()!.houseRules">
            <h2>House Rules</h2>
            <p class="description">{{ listing()!.houseRules }}</p>
          </section>

          <!-- Availability -->
          <section class="info-section">
            <h2>Availability</h2>
            <div class="availability-info">
              <p><strong>Check-in:</strong> {{ listing()!.checkInTime }}</p>
              <p><strong>Check-out:</strong> {{ listing()!.checkOutTime }}</p>
              <p><strong>Minimum nights:</strong> {{ listing()!.minNights }}</p>
              <p><strong>Maximum nights:</strong> {{ listing()!.maxNights || 'No limit' }}</p>
            </div>
          </section>
        </div>

        <!-- Right Column - Stats & Info -->
        <div class="sidebar">
          <!-- Performance Stats -->
          <div class="stats-card">
            <h3>Performance</h3>
            <div class="stat-row">
              <span class="stat-label">Total Views</span>
              <span class="stat-value">{{ listing()!.stats?.viewCount || 0 }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Total Bookings</span>
              <span class="stat-value">{{ listing()!.stats?.bookingCount || 0 }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Rating</span>
              <span class="stat-value">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                {{ listing()!.averageRating?.toFixed(1) || 'N/A' }}
              </span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Reviews</span>
              <span class="stat-value">{{ listing()!.stats?.reviewCount || 0 }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Occupancy Rate</span>
              <span class="stat-value">{{ calculateOccupancyRate() }}%</span>
            </div>
          </div>

          <!-- Pricing Breakdown -->
          <div class="stats-card">
            <h3>Pricing</h3>
            <div class="stat-row">
              <span class="stat-label">Base Price</span>
              <span class="stat-value">{{ formatPrice(listing()!.basePrice) }}</span>
            </div>
            <div class="stat-row" *ngIf="listing()!.cleaningFee">
              <span class="stat-label">Cleaning Fee</span>
              <span class="stat-value">{{ formatPrice(listing()!.cleaningFee!) }}</span>
            </div>
            <div class="stat-row" *ngIf="listing()!.weeklyDiscount">
              <span class="stat-label">Weekly Discount</span>
              <span class="stat-value success">-{{ listing()!.weeklyDiscount }}%</span>
            </div>
            <div class="stat-row" *ngIf="listing()!.monthlyDiscount">
              <span class="stat-label">Monthly Discount</span>
              <span class="stat-value success">-{{ listing()!.monthlyDiscount }}%</span>
            </div>
          </div>

          <!-- Quick Info -->
          <div class="stats-card">
            <h3>Quick Info</h3>
            <div class="stat-row">
              <span class="stat-label">Created</span>
              <span class="stat-value">{{ formatDate(listing()!.createdAt) }}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Last Updated</span>
              <span class="stat-value">{{ formatDate(listing()!.updatedAt) }}</span>
            </div>
            <div class="stat-row" *ngIf="listing()!.publishedAt">
              <span class="stat-label">Published</span>
              <span class="stat-value">{{ formatDate(listing()!.publishedAt!) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bookings Tab -->
    <div *ngIf="activeTab() === 'bookings'" class="bookings-content">
      <!-- Pending Bookings -->
      <section class="bookings-section" *ngIf="getPendingBookings().length > 0">
        <h2>Pending Requests</h2>
        <div class="bookings-list">
          <div *ngFor="let booking of getPendingBookings()" class="booking-card">
            <div class="booking-header">
              <div class="guest-info">
                <img [src]="booking.guestAvatar || '/images/default-avatar.png'" 
                     [alt]="booking.guestName" 
                     class="guest-avatar">
                <div>
                  <h4>{{ booking.guestName }}</h4>
                  <p class="booking-dates">
                    {{ formatDate(booking.checkInDate) }} - {{ formatDate(booking.checkOutDate) }}
                  </p>
                </div>
              </div>
              <span class="badge" [ngClass]="getBookingStatusClass(booking.status)">
                {{ bookingStatusLabels[booking.status] }}
              </span>
            </div>
            
            <div class="booking-details">
              <div class="detail">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                {{ booking.numberOfGuests }} guests
              </div>
              <div class="detail">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                {{ booking.numberOfNights }} nights
              </div>
              <div class="detail price">
                {{ formatPrice(booking.totalPrice) }}
              </div>
            </div>

            <div class="booking-actions">
              <button class="btn-success" (click)="confirmBooking(booking)">Accept</button>
              <button class="btn-danger" (click)="rejectBooking(booking)">Decline</button>
              <button class="btn-secondary" (click)="viewBooking(booking.publicId)">View Details</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Upcoming Bookings -->
      <section class="bookings-section" *ngIf="getUpcomingBookings().length > 0">
        <h2>Upcoming Bookings</h2>
        <div class="bookings-list">
          <div *ngFor="let booking of getUpcomingBookings()" class="booking-card">
            <div class="booking-header">
              <div class="guest-info">
                <img [src]="booking.guestAvatar || '/images/default-avatar.png'" 
                     [alt]="booking.guestName" 
                     class="guest-avatar">
                <div>
                  <h4>{{ booking.guestName }}</h4>
                  <p class="booking-dates">
                    {{ formatDate(booking.checkInDate) }} - {{ formatDate(booking.checkOutDate) }}
                  </p>
                </div>
              </div>
              <span class="badge" [ngClass]="getBookingStatusClass(booking.status)">
                {{ bookingStatusLabels[booking.status] }}
              </span>
            </div>
            
            <div class="booking-details">
              <div class="detail">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                {{ booking.numberOfGuests }} guests
              </div>
              <div class="detail">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                {{ booking.numberOfNights }} nights
              </div>
              <div class="detail price">
                {{ formatPrice(booking.totalPrice) }}
              </div>
            </div>

            <div class="booking-actions">
              <button class="btn-secondary" (click)="viewBooking(booking.publicId)">View Details</button>
            </div>
          </div>
        </div>
      </section>

      <div *ngIf="bookings().length === 0" class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        <h3>No bookings yet</h3>
        <p>Bookings for this listing will appear here</p>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div *ngIf="activeTab() === 'analytics'" class="analytics-content">
      <div class="stats-grid">
        <div class="stat-card-large">
          <div class="stat-icon views">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>{{ listing()!.stats?.viewCount || 0 }}</h3>
            <p>Total Views</p>
          </div>
        </div>

        <div class="stat-card-large">
          <div class="stat-icon bookings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>{{ listing()!.stats?.bookingCount || 0 }}</h3>
            <p>Total Bookings</p>
          </div>
        </div>

        <div class="stat-card-large">
          <div class="stat-icon revenue">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>{{ formatPrice(listing()!.stats?.totalRevenue || 0) }}</h3>
            <p>Total Revenue</p>
          </div>
        </div>

        <div class="stat-card-large">
          <div class="stat-icon rating">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>{{ listing()!.averageRating?.toFixed(1) || 'N/A' }}</h3>
            <p>Average Rating</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Reviews Tab -->
    <div *ngIf="activeTab() === 'reviews'" class="reviews-content">
      <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <h3>Reviews coming soon</h3>
        <p>Guest reviews for this listing will appear here</p>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="loading()" class="loading-state">
  <div class="spinner"></div>
  <p>Loading listing details...</p>
</div>

<!-- Error State -->
<div *ngIf="error()" class="error-state">
  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
    <circle cx="12" cy="12" r="10"/>
    <line x1="12" y1="8" x2="12" y2="12"/>
    <line x1="12" y1="16" x2="12.01" y2="16"/>
  </svg>
  <h3>{{ error() }}</h3>
  <button class="retry-button" (click)="backToListings()">Back to Listings</button>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirm()" class="modal-overlay" (click)="cancelDelete()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Delete Listing?</h2>
    <p>Are you sure you want to delete "{{ listing()!.title }}"? This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn-secondary" (click)="cancelDelete()">Cancel</button>
      <button class="btn-danger" (click)="deleteListing()">Delete Listing</button>
    </div>
  </div>
</div>
