<div
  class="group cursor-pointer"
  role="button"
  tabindex="0"
  (click)="navigateToListing()"
  (keyup.enter)="navigateToListing()"
  (keyup.space)="navigateToListing()"
  (mouseenter)="isHovered = true"
  (mouseleave)="isHovered = false">

  <!-- Image Container -->
  <div class="relative aspect-square w-full mb-3 overflow-hidden rounded-xl">
    <!-- Main Image -->
    <img
      [src]="getDisplayImage()"
      [alt]="listing.title"
      class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">

      <!-- Navigation Buttons -->
      @if (listing.images && listing.images.length > 1 && isHovered) {
        <div
          class="absolute inset-0 flex items-center justify-between px-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
          @if (currentImageIndex > 0) {
            <button
              (click)="previousImage($event)"
              class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-md hover:scale-110 transition-transform duration-200 z-10"
              aria-label="Previous image">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
          }
          @if (currentImageIndex < listing.images.length - 1) {
            <button
              (click)="nextImage($event)"
              class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-md hover:scale-110 transition-transform duration-200 z-10"
              aria-label="Next image">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          }
        </div>
      }

      <!-- Image Indicators -->
      @if (listing.images && listing.images.length > 1) {
        <div
          class="absolute bottom-3 left-1/2 transform -translate-x-1/2 flex gap-1.5 z-10">
          @for (img of listing.images; track img; let i = $index) {
            <button
              (click)="setImage(i, $event)"
              [class.bg-white]="i === currentImageIndex"
              [class.bg-white/60]="i !== currentImageIndex"
              class="w-1.5 h-1.5 rounded-full transition-all duration-200 hover:scale-125"
              [attr.aria-label]="'View image ' + (i + 1)">
            </button>
          }
        </div>
      }

      <!-- Favorite Button -->
      <button
        (click)="toggleFavorite($event)"
        class="absolute top-3 right-3 p-2 rounded-full bg-white/90 backdrop-blur-sm shadow-lg hover:bg-white hover:scale-110 active:scale-95 transition-all duration-200 z-10"
        [class.animate-pulse]="isTogglingFavorite"
        [attr.aria-label]="isFavorite() ? 'Remove from favorites' : 'Add to favorites'">
        @if (isFavorite()) {
          <!-- Filled heart (favorited) - Red with animation -->
          <svg class="w-6 h-6 fill-red-500 stroke-red-500 stroke-1 transition-all duration-200" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
        } @else {
          <!-- Outline heart (not favorited) - Gray outline -->
          <svg class="w-6 h-6 fill-none stroke-gray-600 stroke-2 hover:stroke-red-500 hover:fill-red-50 transition-all duration-200" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
        }
      </button>
    </div>

    <!-- Listing Details -->
    <div class="space-y-1">
      <!-- Location & Rating -->
      <div class="flex items-start justify-between gap-2">
        <h3 class="font-semibold text-gray-900 truncate flex-1">{{ listing.city }}, {{ listing.country }}</h3>
        @if (listing.averageRating) {
          <div class="flex items-center gap-1 shrink-0">
            <svg class="w-3.5 h-3.5 fill-current text-gray-900" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <span class="text-sm font-medium text-gray-900">{{ listing.averageRating.toFixed(2) }}</span>
          </div>
        }
      </div>

      <!-- Title/Category -->
      <p class="text-sm text-gray-600 truncate">{{ listing.category }}</p>

      <!-- Property Details -->
      <p class="text-sm text-gray-600">
        {{ listing.maxGuests }} guests · {{ listing.bedrooms }} bedrooms · {{ listing.beds }} beds · {{ listing.bathrooms }} baths
      </p>

      <!-- Price -->
      <div class="pt-1">
        <span class="font-semibold text-gray-900">${{ listing.pricePerNight.toFixed(0) }}</span>
        <span class="text-sm text-gray-600"> night</span>
      </div>
    </div>
  </div>