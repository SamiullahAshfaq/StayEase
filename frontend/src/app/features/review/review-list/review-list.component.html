<div class="review-list-container">
  <!-- Statistics Section -->
  <div class="review-statistics" *ngIf="showStatistics() && statistics()">
    <div class="statistics-header">
      <div class="overall-rating">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
        <span class="rating-number">{{ statistics()!.averageOverallRating.toFixed(2) }}</span>
        <span class="rating-label">Â· {{ statistics()!.totalReviews }} reviews</span>
      </div>
    </div>

    <div class="rating-breakdown">
      <div class="breakdown-item" *ngFor="let star of [5, 4, 3, 2, 1]">
        <span class="star-label">{{ star }}</span>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" 
            [style.width.%]="getProgressPercentage(
              star === 5 ? statistics()!.fiveStarCount :
              star === 4 ? statistics()!.fourStarCount :
              star === 3 ? statistics()!.threeStarCount :
              star === 2 ? statistics()!.twoStarCount :
              statistics()!.oneStarCount
            )"></div>
        </div>
        <span class="star-count">
          {{ star === 5 ? statistics()!.fiveStarCount :
             star === 4 ? statistics()!.fourStarCount :
             star === 3 ? statistics()!.threeStarCount :
             star === 2 ? statistics()!.twoStarCount :
             statistics()!.oneStarCount }}
        </span>
      </div>
    </div>

    <div class="category-ratings">
      <div class="category-rating-item">
        <span>Cleanliness</span>
        <span class="category-score">{{ statistics()!.averageCleanlinessRating.toFixed(1) }}</span>
      </div>
      <div class="category-rating-item">
        <span>Accuracy</span>
        <span class="category-score">{{ statistics()!.averageAccuracyRating.toFixed(1) }}</span>
      </div>
      <div class="category-rating-item">
        <span>Check-in</span>
        <span class="category-score">{{ statistics()!.averageCheckInRating.toFixed(1) }}</span>
      </div>
      <div class="category-rating-item">
        <span>Communication</span>
        <span class="category-score">{{ statistics()!.averageCommunicationRating.toFixed(1) }}</span>
      </div>
      <div class="category-rating-item">
        <span>Location</span>
        <span class="category-score">{{ statistics()!.averageLocationRating.toFixed(1) }}</span>
      </div>
      <div class="category-rating-item">
        <span>Value</span>
        <span class="category-score">{{ statistics()!.averageValueRating.toFixed(1) }}</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="review-filters">
    <div class="filter-group">
      <button 
        class="filter-button"
        [class.active]="selectedRating() === null"
        (click)="filterByRating(null)">
        All reviews
      </button>
      <button 
        *ngFor="let rating of [5, 4, 3, 2, 1]"
        class="filter-button"
        [class.active]="selectedRating() === rating"
        (click)="filterByRating(rating)">
        {{ rating }} stars
      </button>
      <button 
        class="filter-button"
        [class.active]="onlyWithPhotos()"
        (click)="togglePhotosOnly()">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        With photos
      </button>
    </div>

    <div class="sort-group">
      <label>Sort by:</label>
      <select [(ngModel)]="sortBy" (change)="changeSortBy(sortBy())">
        <option value="createdAt">Most recent</option>
        <option value="overallRating">Highest rated</option>
        <option value="helpfulCount">Most helpful</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading()">
    <div class="spinner"></div>
    <p>Loading reviews...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error()">
    <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    <p>{{ error() }}</p>
    <button class="retry-button" (click)="loadReviews()">Try again</button>
  </div>

  <!-- Reviews List -->
  <div class="reviews-list" *ngIf="!loading() && !error()">
    <div class="review-card" *ngFor="let review of reviews()">
      <!-- Reviewer Info -->
      <div class="reviewer-info">
        <div class="avatar">
          <img [src]="review.reviewerAvatar || '/images/default-avatar.png'" [alt]="review.reviewerName">
        </div>
        <div class="reviewer-details">
          <h3 class="reviewer-name">{{ review.reviewerName }}</h3>
          <p class="reviewer-location" *ngIf="review.reviewerLocation">{{ review.reviewerLocation }}</p>
        </div>
      </div>

      <!-- Rating & Date -->
      <div class="review-meta">
        <div class="stars">
          <svg 
            *ngFor="let star of getStarArray(review.overallRating)" 
            width="12" 
            height="12" 
            [class.filled]="star <= review.overallRating"
            fill="currentColor" 
            viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
        </div>
        <span class="review-date">{{ formatDate(review.createdAt) }}</span>
        <span class="verified-badge" *ngIf="review.isVerifiedStay">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          Verified stay
        </span>
      </div>

      <!-- Review Title -->
      <h4 class="review-title" *ngIf="review.title">{{ review.title }}</h4>

      <!-- Review Comment -->
      <p class="review-comment">{{ review.comment }}</p>

      <!-- Review Photos -->
      <div class="review-photos" *ngIf="review.photoUrls && review.photoUrls.length > 0">
        <img 
          *ngFor="let photo of review.photoUrls.slice(0, 4)" 
          [src]="photo" 
          alt="Review photo"
          class="review-photo">
        <div class="more-photos" *ngIf="review.photoUrls.length > 4">
          +{{ review.photoUrls.length - 4 }}
        </div>
      </div>

      <!-- Public Response -->
      <div class="public-response" *ngIf="review.hasResponse && review.publicResponse">
        <div class="response-header">
          <strong>Response from {{ review.revieweeName }}:</strong>
          <span class="response-date">{{ formatDate(review.publicResponseDate!) }}</span>
        </div>
        <p>{{ review.publicResponse }}</p>
      </div>

      <!-- Review Actions -->
      <div class="review-actions">
        <button 
          class="action-button"
          [class.active]="review.isHelpfulByCurrentUser"
          (click)="toggleHelpful(review)">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
          </svg>
          <span>Helpful ({{ review.helpfulCount }})</span>
        </button>
        <button 
          class="action-button"
          *ngIf="!review.isReportedByCurrentUser"
          (click)="reportReview(review, 'inappropriate')">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/>
          </svg>
          Report
        </button>
      </div>

      <!-- Highlighted Badge -->
      <div class="highlighted-badge" *ngIf="review.isHighlighted">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd"/>
        </svg>
        Top review
      </div>
    </div>

    <!-- No Reviews -->
    <div class="no-reviews" *ngIf="reviews().length === 0">
      <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
      </svg>
      <h3>No reviews yet</h3>
      <p>Be the first to share your experience!</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!loading() && reviews().length > 0 && totalPages() > 1">
    <button 
      class="pagination-button"
      [disabled]="currentPage() === 0"
      (click)="previousPage()">
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Previous
    </button>

    <div class="pagination-pages">
      <button 
        *ngFor="let page of [].constructor(totalPages()); let i = index"
        class="page-button"
        [class.active]="currentPage() === i"
        (click)="goToPage(i)"
        [hidden]="i > 2 && i < totalPages() - 1 && Math.abs(i - currentPage()) > 1">
        {{ i + 1 }}
      </button>
    </div>

    <button 
      class="pagination-button"
      [disabled]="currentPage() === totalPages() - 1"
      (click)="nextPage()">
      Next
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
</div>
