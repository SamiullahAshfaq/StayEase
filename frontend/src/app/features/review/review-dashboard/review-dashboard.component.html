<div class="review-dashboard-container">
  <div class="dashboard-header">
    <h1>Your Reviews</h1>
    <p>Manage your reviews and see what others have said</p>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab"
      [class.active]="activeTab() === 'pending'"
      (click)="switchTab('pending')">
      <span>Pending</span>
      <span class="badge" *ngIf="pendingReviews().length > 0">{{ pendingReviews().length }}</span>
    </button>
    <button 
      class="tab"
      [class.active]="activeTab() === 'written'"
      (click)="switchTab('written')">
      Reviews by you
    </button>
    <button 
      class="tab"
      [class.active]="activeTab() === 'received'"
      (click)="switchTab('received')">
      Reviews about you
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading()">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error() && !loading()">
    <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    <p>{{ error() }}</p>
    <button class="retry-button" (click)="loadData()">Try again</button>
  </div>

  <!-- Pending Reviews Tab -->
  <div class="tab-content" *ngIf="!loading() && activeTab() === 'pending'">
    <div class="pending-reviews" *ngIf="pendingReviews().length > 0">
      <div class="pending-card" *ngFor="let pending of pendingReviews()">
        <div class="pending-image">
          <img [src]="pending.propertyImage" [alt]="pending.propertyTitle">
        </div>
        <div class="pending-details">
          <h3>{{ pending.propertyTitle }}</h3>
          <p class="host-info">Hosted by {{ pending.hostName }}</p>
          <p class="stay-dates">
            {{ formatDate(pending.checkInDate) }} - {{ formatDate(pending.checkOutDate) }}
          </p>
          <div class="deadline-info" [class.urgent]="getDaysRemaining(pending.canReviewUntil) <= 3">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            <span>{{ getDaysRemaining(pending.canReviewUntil) }} days left to review</span>
          </div>
        </div>
        <div class="pending-actions">
          <a 
            [routerLink]="['/review/write']" 
            [queryParams]="{ booking: pending.bookingPublicId }"
            class="btn btn-primary">
            Write Review
          </a>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="pendingReviews().length === 0">
      <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      <h3>No pending reviews</h3>
      <p>You're all caught up! Reviews will appear here after your stays.</p>
    </div>
  </div>

  <!-- Written Reviews Tab -->
  <div class="tab-content" *ngIf="!loading() && activeTab() === 'written'">
    <div class="review-list" *ngIf="writtenReviews().length > 0">
      <div class="review-card" *ngFor="let review of writtenReviews()">
        <div class="review-header">
          <div class="property-info">
            <img [src]="review.propertyImage || review.serviceImage" [alt]="review.propertyTitle || review.serviceTitle">
            <div>
              <h3>{{ review.propertyTitle || review.serviceTitle }}</h3>
              <p>{{ review.revieweeName }}</p>
            </div>
          </div>
          <div class="review-status">
            <span class="status-badge" [class]="review.status.toLowerCase()">
              {{ review.status }}
            </span>
          </div>
        </div>

        <div class="review-content">
          <div class="stars">
            <svg 
              *ngFor="let star of getStarArray(review.overallRating)" 
              width="16" 
              height="16" 
              [class.filled]="star <= review.overallRating"
              fill="currentColor" 
              viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          </div>
          <h4 *ngIf="review.title">{{ review.title }}</h4>
          <p>{{ review.comment }}</p>
          <span class="review-date">{{ formatDate(review.createdAt) }}</span>
        </div>

        <div class="review-response" *ngIf="review.hasResponse">
          <div class="response-indicator">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
            </svg>
            <span>Host responded</span>
          </div>
        </div>

        <div class="review-engagement">
          <span>{{ review.helpfulCount }} found this helpful</span>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="writtenReviews().length === 0">
      <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
      <h3>You haven't written any reviews yet</h3>
      <p>Share your experiences to help others make informed decisions.</p>
    </div>
  </div>

  <!-- Received Reviews Tab -->
  <div class="tab-content" *ngIf="!loading() && activeTab() === 'received'">
    <div class="review-list" *ngIf="receivedReviews().length > 0">
      <div class="review-card" *ngFor="let review of receivedReviews()">
        <div class="review-header">
          <div class="reviewer-info">
            <img [src]="review.reviewerAvatar || '/images/default-avatar.png'" [alt]="review.reviewerName">
            <div>
              <h3>{{ review.reviewerName }}</h3>
              <p *ngIf="review.reviewerLocation">{{ review.reviewerLocation }}</p>
            </div>
          </div>
          <div class="review-meta">
            <div class="stars">
              <svg 
                *ngFor="let star of getStarArray(review.overallRating)" 
                width="16" 
                height="16" 
                [class.filled]="star <= review.overallRating"
                fill="currentColor" 
                viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
            </div>
            <span class="review-date">{{ formatDate(review.createdAt) }}</span>
          </div>
        </div>

        <div class="review-content">
          <h4 *ngIf="review.title">{{ review.title }}</h4>
          <p>{{ review.comment }}</p>
        </div>

        <div class="property-reference" *ngIf="review.propertyTitle">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
          </svg>
          <span>{{ review.propertyTitle }}</span>
        </div>

        <div class="response-actions" *ngIf="!review.hasResponse">
          <a 
            [routerLink]="['/review/respond', review.publicId]"
            class="btn btn-secondary">
            Respond to review
          </a>
        </div>

        <div class="public-response" *ngIf="review.hasResponse && review.publicResponse">
          <strong>Your response:</strong>
          <p>{{ review.publicResponse }}</p>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="receivedReviews().length === 0">
      <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
      </svg>
      <h3>No reviews yet</h3>
      <p>Reviews from your guests will appear here.</p>
    </div>
  </div>
</div>
